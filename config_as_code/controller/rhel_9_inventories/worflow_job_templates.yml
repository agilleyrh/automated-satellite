---
controller_workflows:
  - name: LEAPP / 02 Upgrade
    description: Workflow for Snapshot and Leapp Upgrade
    extra_vars:
      lvm_snapshots_action: create
    inventory: EC2 Dynamic Inventory
    state: present
    organization: Default
    survey_enabled: true
    survey_spec:
      name: ''
      description: ''
      spec:
        - question_name: Select inventory group
          type: multiplechoice
          variable: dynamic_inventory_group
          choices: "{{ hostvars['satellite.example.com']['satellite_lifecycle_environments'] | selectattr('name', 'match', '^RHEL.*$') | map(attribute='name') | list}}"
          required: true
    ask_limit_on_launch: true
    simplified_workflow_nodes:
      - identifier: UTILITY / Snapshot Instance
        unified_job_template: UTILITY / Snapshot Instance
        organization: Default
        all_parents_must_converge: false
        success_nodes:
          - OS / Upgrade
      - identifier: OS / Upgrade
        unified_job_template: OS / Upgrade
        organization: Default
        all_parents_must_converge: false
        success_nodes: []

  - name: LEAPP / 03 Rollback
    description: Revert node workflow - selection via dynamic inventory group
    extra_vars:
      snapshot_set_name: snap01
      snapshot_create_boot_backup: true
      lvm_snapshots_action: revert
      org_id: "Default_Organization"
    state: present
    organization: Default
    survey_enabled: true
    survey_spec:
      name: ''
      description: ''
      spec:
        - question_name: Select inventory group
          type: multiplechoice
          variable: dynamic_inventory_group
          choices: "{{ hostvars['satellite.example.com']['satellite_lifecycle_environments'] | selectattr('name', 'match', '^RHEL.*$') | map(attribute='name') | list}}"
          required: true
    ask_limit_on_launch: true
    simplified_workflow_nodes:
      - identifier: UTILITY / Snapshot Instance
        unified_job_template: UTILITY / Snapshot Instance
        organization: Default
        all_parents_must_converge: false
        success_nodes:
          - SERVER / Unregister
      - identifier: SERVER / Unregister
        unified_job_template: SERVER / Unregister
        organization: Default
        all_parents_must_converge: false
        success_nodes:
          - SERVER / Register
      - identifier: SERVER / Register
        unified_job_template: SERVER / Register
        organization: Default
        all_parents_must_converge: false
        type: inventory_source
        success_nodes: []

  - name: LEAPP / 04 Commit
    description: Workflow for Snapshot delete and Update instance tags
    extra_vars:
      lvm_snapshots_action: remove
    inventory: EC2 Dynamic Inventory
    state: present
    organization: Default
    survey_enabled: true
    survey_spec:
      name: ''
      description: ''
      spec:
        - question_name: Select inventory group
          type: multiplechoice
          variable: dynamic_inventory_group
          choices: "{{ hostvars['satellite.example.com']['satellite_lifecycle_environments'] | selectattr('name', 'match', '^RHEL8.*$') | map(attribute='name') | list}}"
          required: true
    ask_limit_on_launch: true
    simplified_workflow_nodes:
      - identifier: UTILITY / Snapshot Instance
        unified_job_template: UTILITY / Snapshot Instance
        organization: Default
        all_parents_must_converge: false
        success_nodes:
          - EC2 / Set instance tags based on Satellite facts
      - identifier: EC2 / Set instance tags based on Satellite facts
        unified_job_template: EC2 / Set instance tags based on Satellite facts
        organization: Default
        all_parents_must_converge: false
        success_nodes:
          - RHEL7 Development
      - identifier: RHEL7 Development
        unified_job_template: RHEL7 Development
        organization: Default
        all_parents_must_converge: false
        type: inventory_source
        success_nodes:
          - RHEL8 Development
      - identifier: RHEL8 Development
        unified_job_template: RHEL8 Development
        organization: Default
        all_parents_must_converge: false
        type: inventory_source
        success_nodes:
          - RHEL9 Development
      - identifier: RHEL9 Development
        unified_job_template: RHEL9 Development
        organization: Default
        all_parents_must_converge: false
        type: inventory_source
        success_nodes: []

  - name: OS / Conversion plus upgrade CentOS7 to RHEL9
    description: Workflow for CentOS7 to RHEL9 conversion/upgrade
    extra_vars:
      snapshot_set_name: snap01
      snapshot_create_snapshot_autoextend_threshold: 70
      snapshot_create_snapshot_autoextend_percent: 20
      snapshot_create_boot_backup: true
      snapshot_create_volumes:
        - vg: VolGroup00
          lv: rootVol
          size: 5G
        - vg: VolGroup00
          lv: varVol
          size: 7G
        - vg: VolGroup00
          lv: logVol
          size: 500M
        - vg: VolGroup00
          lv: auditVol
          size: 100M
    inventory: Workshop Inventory
    state: present
    organization: Default
    ask_limit_on_launch: true
    simplified_workflow_nodes:
      - identifier: Three Tier App smoke test CentOS7
        unified_job_template: CONVERT2RHEL / 99 - Three Tier App smoke test
        organization: Default
        all_parents_must_converge: false
        success_nodes:
          - CONVERT2RHEL / 01 Analysis
      - identifier: CONVERT2RHEL / 01 Analysis
        unified_job_template: CONVERT2RHEL / 01 Analysis
        organization: Default
        extra_data:
          dynamic_inventory_group: CentOS7_Dev
          rhel_lifecycle_environment: RHEL7_Dev
        all_parents_must_converge: false
        success_nodes:
          - UTILITY / Clear yum cache
      - identifier: UTILITY / Clear yum cache
        unified_job_template: UTILITY / Clear yum cache
        organization: Default
        extra_data:
          dynamic_inventory_group: CentOS7_Dev
        all_parents_must_converge: false
        success_nodes:
          - UTILITY / Snapshot Instance
      - identifier: UTILITY / Snapshot Instance
        unified_job_template: UTILITY / Snapshot Instance
        organization: Default
        extra_data:
          dynamic_inventory_group: CentOS7_Dev
          lvm_snapshots_action: create
        all_parents_must_converge: false
        success_nodes:
          - CentOS7 conversion to RHEL7
      - identifier: CentOS7 conversion to RHEL7
        unified_job_template: OS / Convert to RHEL
        organization: Default
        extra_data:
          dynamic_inventory_group: CentOS7_Dev
          rhel_lifecycle_environment: RHEL7_Dev
        all_parents_must_converge: false
        success_nodes:
          - Three Tier App smoke test RHEL7
      - identifier: Three Tier App smoke test RHEL7
        unified_job_template: CONVERT2RHEL / 99 - Three Tier App smoke test
        organization: Default
        all_parents_must_converge: false
        success_nodes:
          - Set instance tags based on Satellite facts 1
      - identifier: Set instance tags based on Satellite facts 1
        unified_job_template: EC2 / Set instance tags based on Satellite facts
        organization: Default
        all_parents_must_converge: false
        success_nodes:
          - RHEL7 Development inventory source 1
      - identifier: RHEL7 Development inventory source 1
        unified_job_template: RHEL7 Development
        organization: Default
        all_parents_must_converge: false
        type: inventory_source
        success_nodes:
          - CentOS7 Development inventory source
      - identifier: CentOS7 Development inventory source
        unified_job_template: CentOS7 Development
        organization: Default
        all_parents_must_converge: false
        type: inventory_source
        success_nodes:
          - Initial LEAPP Analysis RHEL7_Dev
      - identifier: Initial LEAPP Analysis RHEL7_Dev
        unified_job_template: LEAPP / 01 Analysis
        organization: Default
        extra_data:
          dynamic_inventory_group: RHEL7_Dev
        limit: node4.example.com,node5.example.com,node6.example.com
        all_parents_must_converge: false
        success_nodes:
          - OS Remediation RHEL7_Dev 
      - identifier: OS Remediation RHEL7_Dev
        unified_job_template: OS / Remediation
        organization: Default
        extra_data:
          dynamic_inventory_group: RHEL7_Dev
        limit: node4.example.com,node5.example.com,node6.example.com
        all_parents_must_converge: false
        success_nodes:
          - Post remediation LEAPP Analysis RHEL7_Dev
      - identifier: Post remediation LEAPP Analysis RHEL7_Dev
        unified_job_template: LEAPP / 01 Analysis
        organization: Default
        extra_data:
          dynamic_inventory_group: RHEL7_Dev
        limit: node4.example.com,node5.example.com,node6.example.com
        all_parents_must_converge: false
        success_nodes:
          - OS / Upgrade RHEL7 to RHEL8
      - identifier: OS / Upgrade RHEL7 to RHEL8
        unified_job_template: OS / Upgrade
        organization: Default
        extra_data:
          dynamic_inventory_group: RHEL7_Dev
        limit: node4.example.com,node5.example.com,node6.example.com
        all_parents_must_converge: false
        success_nodes:
          - Three Tier App postgresql upgrade RHEL8
      - identifier: Three Tier App postgresql upgrade RHEL8
        unified_job_template: SERVER / Three Tier App postgresql upgrade
        organization: Default
        all_parents_must_converge: false
        success_nodes:
          - Three Tier App smoke test RHEL8
      - identifier: Three Tier App smoke test RHEL8
        unified_job_template: CONVERT2RHEL / 99 - Three Tier App smoke test
        organization: Default
        all_parents_must_converge: false
        success_nodes:
          - Set instance tags based on Satellite facts 2 
      - identifier: Set instance tags based on Satellite facts 2
        unified_job_template: EC2 / Set instance tags based on Satellite facts
        organization: Default
        all_parents_must_converge: false
        success_nodes:
          - RHEL7 Development inventory source 2
      - identifier: RHEL7 Development inventory source 2
        unified_job_template: RHEL7 Development
        organization: Default
        all_parents_must_converge: false
        type: inventory_source
        success_nodes:
          - RHEL8 Development inventory source 1
      - identifier: RHEL8 Development inventory source 1
        unified_job_template: RHEL8 Development
        organization: Default
        all_parents_must_converge: false
        type: inventory_source
        success_nodes: []
...
